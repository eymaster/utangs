<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Debt List | DebtHelp</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }
    .card-shadow {
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <h2 class="text-center mb-4">ðŸ“‹ Debt Overview</h2><form method="get" class="row g-2 align-items-center justify-content-center mb-4" action="{{ url_for('debts') }}">
  <div class="col-auto">
    <select name="name" class="form-select" onchange="this.form.submit()">
      <option value="">All Names</option>
      {% for name in all_names %}
        <option value="{{ name }}" {% if name == name_filter %}selected{% endif %}>{{ name }}</option>
      {% endfor %}
    </select>
  </div>
  {% if name_filter %}
  <div class="col-auto">
    <a href="{{ url_for('debts') }}" class="btn btn-outline-secondary">Clear Filter</a>
  </div>
  {% endif %}
</form>

<button class="btn btn-outline-primary w-100 mb-3" data-bs-toggle="collapse" data-bs-target="#summaryCollapse">
  ðŸ’° View Total Utang Summary
</button>

<div class="collapse" id="summaryCollapse">
  <div class="card card-body card-shadow">
    <div class="alert alert-info">
      <strong>Total Amount Owed:</strong> PHP {{ "%.2f"|format(total_debt) }}
    </div>
    <div class="table-responsive">
      <table class="table table-bordered table-hover text-center">
        <thead class="table-light">
          <tr>
            <th>Name</th>
            <th>Total Amount (PHP)</th>
          </tr>
        </thead>
        <tbody>
          {% for name, amount in debts_summary %}
          <tr>
            <td>{{ name }}</td>
            <td>{{ "%.2f"|format(amount) }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="card mt-4 card-shadow">
  <div class="card-header bg-dark text-white text-center">
    <h5 class="mb-0">ðŸ§¾ Detailed Debt Records</h5>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-striped table-bordered text-center mb-0">
        <thead class="table-dark">
          <tr>
            <th>Name</th>
            <th>Amount (PHP)</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for debt in debts %}
          <tr class="{% if debt.status == 'Pending' %}table-danger{% endif %}">
            <td>{{ debt.name }}</td>
            <td>{{ "%.2f"|format(debt.amount) }}</td>
            <td>{{ debt.reason }}</td>
            <td>
              {% if debt.status == 'Paid' %}
                <span class="badge bg-success">Paid</span>
              {% else %}
                <span class="badge bg-warning text-dark">Pending</span>
              {% endif %}
              <input type="checkbox" class="status-toggle ms-2" data-id="{{ debt.id }}" {% if debt.status == 'Paid' %}checked{% endif %}>
            </td>
            <td>
              <a href="{{ url_for('edit', debt_id=debt.id) }}" class="btn btn-sm btn-outline-warning">Edit</a>
              <a href="{{ url_for('delete', debt_id=debt.id) }}" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this record?');">Delete</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="text-center mt-4">
  <a href="/" class="btn btn-success w-100">âž• Add Another Debt</a>
</div>

  </div>  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>  <script>
    document.querySelectorAll('.status-toggle').forEach(checkbox => {
      checkbox.addEventListener('change', async function () {
        const debtId = this.getAttribute('data-id');
        const newStatus = this.checked ? 'Paid' : 'Pending';

        const response = await fetch(`/toggle_status/${debtId}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status: newStatus })
        });

        if (!response.ok) {
          alert('Failed to update status');
        } else {
          location.reload();
        }
      });
    });
  </script></body>
</html>
